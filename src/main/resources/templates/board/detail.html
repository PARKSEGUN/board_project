<!DOCTYPE html>
<html   xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/default_layout}">
<div layout:fragment="content">
  <!-- Section-->

  <section class="container">
    <h1>글 상세보기</h1>
    <br>

<!--    수정했다   -->
    <div  th:if="${loginUser.id}==${board.user.id}">

<!--      이부분 부터 시작-->

      <button type="button" th:onclick="|location.href='@{/board/modifyForm/{boardId}(boardId=${board.id})}'|" class="btn btn-warning">글 수정&nbsp;</button>
      <button type="submit" class="btn btn-danger" id="btn-danger">글 삭제</button>
    </div>


    <br><br>
      <div class="form-group">
        <h1> 제목 : [[${board.title}]]</h1>
      </div>
      <br>
    <div class="form-group">
      <h1> 작성자 : [[${board.user.username}]]</h1>
    </div>
    <br>
      <div class="form-group">
        <h1> 내용 : </h1>
        <div  id="content"  th:utext="${board.content}"></div>
      </div>
      </br>
      <div class="form-group">
          <h1> 조횟수 : [[${board.hit}]]</h1>
      </div>
      <br>
    <div class="form-group">
      <h1> 작성 시간 : [[${board.createTime}]]</h1>
    </div>
<!--    jquery를 사용해서 데이터를 주기위한 input 태그-->
    <input id="boardId" type="hidden" th:value="${board.id}">
    <script>
    // 메인화면 페이지 로드 함수
    $(document).ready(function () {
    
        $('#summernote').summernote({
            height: 400,
            maxHeight: 400
        });
    });

        </script>
    <script>

        $(document).ready(function(){
        let boardId=$("#boardId").val();
            $("#btn-danger").click(function(){
                if(confirm("정말로 글을 삭제하시겠습니까?")){
                    location.href='/board/delete/'+boardId;
                }
            });
        });


    </script>
<!--      <body>-->

<!--      <div class="container">-->
<!--          <h2>댓글 작성 :</h2>-->
<!--          <form action="/reply/save" method="post">-->
<!--              <div class="form-group">-->
<!--                  <label for="replyContent">Comment:</label>-->
<!--                  <textarea class="form-control" rows="5" id="replyContent" name="content"></textarea>-->
<!--              </div>-->
<!--              <button type="submit" class="btn btn-primary">댓글 달기</button>-->
<!--          </form>-->
<!--      </div>-->
<!--      </body>-->

<!--      <%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>-->
<!--      <%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>-->
<!--      <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>-->
<!--      <%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>-->
<!--      <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>-->
<!--      <%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>-->
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
      <html>
      <head>
          <link rel="stylesheet" href="/css/bootstrap.css">
      </head>
      <body>
      <div class="container">
          <form id="commentForm" name="commentForm" method="post">
              <br><br>
              <div>
                  <div>
                      <span><strong>Comments</strong></span> <span id="cCnt"></span>
                  </div>
                  <div>
                      <table class="table">
                          <tr>
                              <td>
                                  <textarea style="width: 1100px" rows="3" cols="30" id="replyContent" name="content" placeholder="댓글을 입력하세요"></textarea>
                                  <br>
                                  <div>
                                      <a href='#' onClick="fn_comment('${result.code }')" class="btn pull-right btn-success">등록</a>
                                  </div>
                              </td>
                          </tr>
                      </table>
                  </div>
              </div>
              <input type="hidden" id="b_code" name="b_code" value="${result.code }" />
          </form>
      </div>
      <div class="container">
          <form id="commentListForm" name="commentListForm" method="post">
              <div id="commentList">
              </div>
          </form>
      </div>

      <script>
          /*
           * 댓글 등록하기(Ajax)
           */
          function fn_comment(code){

              $.ajax({
                  type:'POST',
                  url : "<c:url value='/board/addComment.do'/>",
                  data:$("#commentForm").serialize(),
                  success : function(data){
                      if(data=="success")
                      {
                          getCommentList();
                          $("#content").val("");
                      }
                  },
                  error:function(request,status,error){
                      //alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                  }

              });
          }

          /**
           * 초기 페이지 로딩시 댓글 불러오기
           */
          $(function(){

              getCommentList();

          });

          /**
           * 댓글 불러오기(Ajax)
           */
          function getCommentList(){

              $.ajax({
                  type:'GET',
                  url : "<c:url value='/board/ReplyList.do'/>",
                  dataType : "json",
                  data:$("#commentForm").serialize(),
                  contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                  success : function(data){

                      var html = "";
                      var cCnt = data.length;

                      if(data.length > 0){

                          for(i=0; i<data.length; i++){
                              html += "<div>";
                              html += "<div><table class='table'><h6><strong>"+data[i].writer+"</strong></h6>";
                              html += data[i].comment + "<tr><td></td></tr>";
                              html += "</table></div>";
                              html += "</div>";
                          }

                      } else {

                          html += "<div>";
                          html += "<div><table class='table'><h6><strong>등록된 댓글이 없습니다.</strong></h6>";
                          html += "</table></div>";
                          html += "</div>";

                      }

                      $("#cCnt").html(cCnt);
                      $("#replyContent").html(html);

                  },
                  error:function(request,status,error){

                  }

              });
          }

      </script>

      </body>
      </html>



  </section>
</div>